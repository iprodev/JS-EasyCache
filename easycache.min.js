/**
 * JS-EasyCache v1.0.0
 *
 * By Hemn Chawroka
 * http://iprodev.com
 *
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 */

/* jshint undef:true, browser:true, node:true */
/* global define */
(function(u,x){"function"===typeof define&&define.amd?define([],x):"undefined"!==typeof module&&module.exports?module.exports=x():u.EasyCache=x()})(this,function(){function u(){if(void 0!==w)return w;try{A("__easycachetest__","__easycachetest__"),y("__easycachetest__"),w=!0}catch(a){w=x(a)?!0:!1}return w}function x(a){return a&&"QUOTA_EXCEEDED_ERR"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name||"QuotaExceededError"===a.name?!0:!1}function G(){void 0===C&&(C=null!=window.JSON);return C}function A(a,e){localStorage.removeItem("EasyCache-"+p+a);localStorage.setItem("EasyCache-"+p+a,e)}function y(a){localStorage.removeItem("EasyCache-"+p+a)}function D(a){for(var e=new RegExp("^EasyCache-"+p.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")+"(.*)"),k=localStorage.length-1;0<=k;--k){var d=localStorage.key(k);(d=(d=d&&d.match(e))&&d[1])&&0>d.indexOf("-cacheexpiration")&&a(d,d+"-cacheexpiration")}}function E(a){var e=a+"-cacheexpiration";y(a);y(e)}function H(a){var e=a+"-cacheexpiration",k=localStorage.getItem("EasyCache-"+p+e);if(k&&(k=parseInt(k,10),Math.floor((new Date).getTime()/6E4)>=k))return y(a),y(e),!0}function F(a,e){I&&"console"in window&&"function"===typeof window.console.warn&&(window.console.warn("JS-EasyCache - "+a),e&&window.console.warn("JS-EasyCache - The error was: "+e.message))}var J=Math.floor(144E9),w,C,p="",I=!1,z=String.fromCharCode,B={compress:function(a){return B._compress(a,16,function(a){return z(a)})},_compress:function(a,e,k){if(null==a)return"";var d,g,q={},v={},h="",p="",l="",m=2,r=3,f=2,n=[],c=0,b=0,t;for(t=0;t<a.length;t+=1)if(h=a.charAt(t),Object.prototype.hasOwnProperty.call(q,h)||(q[h]=r++,v[h]=!0),p=l+h,Object.prototype.hasOwnProperty.call(q,p))l=p;else{if(Object.prototype.hasOwnProperty.call(v,l)){if(256>l.charCodeAt(0)){for(d=0;d<f;d++)c<<=1,b==e-1?(b=0,n.push(k(c)),c=0):b++;g=l.charCodeAt(0);for(d=0;8>d;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1}else{g=1;for(d=0;d<f;d++)c=c<<1|g,b==e-1?(b=0,n.push(k(c)),c=0):b++,g=0;g=l.charCodeAt(0);for(d=0;16>d;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1}m--;0==m&&(m=Math.pow(2,f),f++);delete v[l]}else for(g=q[l],d=0;d<f;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1;m--;0==m&&(m=Math.pow(2,f),f++);q[p]=r++;l=String(h)}if(""!==l){if(Object.prototype.hasOwnProperty.call(v,l)){if(256>l.charCodeAt(0)){for(d=0;d<f;d++)c<<=1,b==e-1?(b=0,n.push(k(c)),c=0):b++;g=l.charCodeAt(0);for(d=0;8>d;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1}else{g=1;for(d=0;d<f;d++)c=c<<1|g,b==e-1?(b=0,n.push(k(c)),c=0):b++,g=0;g=l.charCodeAt(0);for(d=0;16>d;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1}m--;0==m&&(m=Math.pow(2,f),f++);delete v[l]}else for(g=q[l],d=0;d<f;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1;m--;0==m&&(Math.pow(2,f),f++)}g=2;for(d=0;d<f;d++)c=c<<1|g&1,b==e-1?(b=0,n.push(k(c)),c=0):b++,g>>=1;for(;;)if(c<<=1,b==e-1){n.push(k(c));break}else b++;return n.join("")},decompress:function(a){return null==a?"":""==a?null:B._decompress(a.length,32768,function(e){return a.charCodeAt(e)})},_decompress:function(a,e,k){var d=[],g=4,q=4,p=3,h="",u=[],l,m,r,f,n,c=k(0),b=e,t=1;for(l=0;3>l;l+=1)d[l]=l;h=0;r=Math.pow(2,2);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;switch(h){case 0:h=0;r=Math.pow(2,8);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;n=z(h);break;case 1:h=0;r=Math.pow(2,16);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;n=z(h);break;case 2:return""}l=d[3]=n;for(u.push(n);){if(t>a)return"";h=0;r=Math.pow(2,p);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;switch(n=h){case 0:h=0;r=Math.pow(2,8);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;d[q++]=z(h);n=q-1;g--;break;case 1:h=0;r=Math.pow(2,16);for(f=1;f!=r;)m=c&b,b>>=1,0==b&&(b=e,c=k(t++)),h|=(0<m?1:0)*f,f<<=1;d[q++]=z(h);n=q-1;g--;break;case 2:return u.join("")}0==g&&(g=Math.pow(2,p),p++);if(d[n])h=d[n];else if(n===q)h=l+l.charAt(0);else return null;u.push(h);d[q++]=l+h.charAt(0);g--;l=h;0==g&&(g=Math.pow(2,p),p++)}}};return{set:function(a,e,k){if(u()){if("string"!==typeof e){if(!G())return;try{e=JSON.stringify(e)}catch(d){return}}e&&(e=B.compress(e));try{A(a,e)}catch(g){if(x(g)){var q=[],v;D(function(a,d){var e=localStorage.getItem("EasyCache-"+p+d),e=e?parseInt(e,10):J;q.push({key:a,size:(localStorage.getItem("EasyCache-"+p+a)||"").length,expiration:e})});q.sort(function(a,d){return d.expiration-a.expiration});for(var h=(e||"").length;q.length&&0<h;)v=q.pop(),F("Cache is full, removing item with key '"+a+"'"),E(v.key),h-=v.size;try{A(a,e)}catch(w){F("Could not add item with key '"+a+"', perhaps it's too big?",w);return}}else{F("Could not add item with key '"+a+"'",g);return}}k?A(a+"-cacheexpiration",(Math.floor((new Date).getTime()/6E4)+k).toString(10)):y(a+"-cacheexpiration")}},get:function(a){if(!u()||H(a))return null;(a=localStorage.getItem("EasyCache-"+p+a))&&(a=B.decompress(a));if(!a||!G())return a;try{return JSON.parse(a)}catch(e){return a}},remove:function(a){u()&&E(a)},supported:function(){return u()},flush:function(){u()&&D(function(a){E(a)})},flushExpired:function(){u()&&D(function(a){H(a)})},setBucket:function(a){p=a},resetBucket:function(){p=""},enableWarnings:function(a){I=a}}});